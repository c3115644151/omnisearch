import { $, m } from "../../aside/index.js";
import { onMounted, onBeforeUnmount } from "vue";
const check = (target, range) => {
  if (!range) {
    return true;
  }
  return range.contains(target);
};
const getEl = (ref) => {
  if (m(ref)) {
    const res = ref();
    return res instanceof HTMLElement ? res : null;
  }
  if (!ref.value) {
    return null;
  }
  return ref.value instanceof HTMLElement ? ref.value : ref.value.el && ref.value.el instanceof HTMLElement ? ref.value.el : null;
};
const useClickOutsideListener = (ref, callback) => {
  const clickOutsideHandler = (event) => {
    const target = event.target;
    if (!(target instanceof HTMLElement)) {
      return;
    }
    if ($(ref) ? ref.length === 0 : m(ref) ? false : !ref.value) {
      return;
    }
    const clickInside = $(ref) ? ref.reduce((pre, cur) => {
      return pre || check(target, getEl(cur));
    }, false) : check(target, getEl(ref));
    if (!clickInside) {
      callback(event);
    }
  };
  onMounted(() => {
    document.addEventListener("click", clickOutsideHandler);
  });
  onBeforeUnmount(() => {
    document.removeEventListener("click", clickOutsideHandler);
  });
};
export {
  useClickOutsideListener as u
};
